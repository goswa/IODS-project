---
title: "Analysis of Longitudinal Data"
author: "Shweta Goswami"
date: "8-12-2018"
output: html_document
---

# Analysis of Longitudinal Data

## Analysis of RATS data


```{r, include=FALSE}
setwd("~/GitHub/IODS-project/data")
load("~/GitHub/IODS-project/data/RATSL.Rdata")
library(readr)
BPRS <- read_csv("RATS.csv")

```

### **Overview of RATSL (long form) data**

```{r, echo=FALSE}
library(dplyr)
head(RATSL)
summary(RATSL)
glimpse(RATSL)
```


### **Graphical overview of RATSL data**

```{r, echo=FALSE}
library(tidyr)
library(dplyr)
library(ggplot2)

# Draw the plot
ggplot(RATSL, aes(x = Time, y = Weight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(RATSL$Weight), max(RATSL$Weight)))
```


### **Graphical overview after standardization**

```{r, echo=FALSE}

# Standardise the variable 
RATSL <- RATSL %>%
  group_by(Group) %>%
  mutate(stdweight = (Weight - mean(Weight))/sd(Weight) ) %>%
  ungroup()

# Glimpse the data
glimpse(RATSL)

# Plot again 
ggplot(RATSL, aes(x = Time, y = stdweight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  scale_y_continuous(name = "standardized weight")

```


### **Plotting the mean profiles**


```{r, echo=FALSE}


n <- RATSL$Time %>% unique() %>% length()

# Summary data with mean and standard error of bprs by treatment and week 
RATSS <- RATSL %>%
  group_by(Group, Time) %>%
  summarise( mean = mean(Weight), se = sd(Weight)/sqrt(n) ) %>%
  ungroup()

# Glimpse the data
glimpse(RATSS)

# Plot the mean profiles
ggplot(RATSS, aes(x = Time, y = mean, linetype = Group, shape = Group)) +
  geom_line() +
  geom_point(size=3) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.8,0.8)) +
  scale_y_continuous(name = "mean(Weight) +/- se(Weight)")

```


### **Creating boxplot of the new data to check the outlier** 

```{r, echo=FALSE}


# Create a summary data 
RATSL8S <- RATSL %>%
  group_by(Group, ID) %>%
  summarise( mean=mean(Weight) ) %>%
  ungroup()

# Glimpse the data
glimpse(RATSL8S)

# Draw a boxplot of the mean versus group
ggplot(RATSL8S, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun.y = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(Weight), time 1-64")

# Create a new data by filtering the outlier and adjust the ggplot code the draw the plot again with the new data
RATSL8S1 <- RATSL8S %>%
  filter(mean < 550)

# Draw a boxplot of the mean versus group
ggplot(RATSL8S1, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun.y = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(Weight), time 1-60")

```



### **Analysis of Variance**

```{r, echo=FALSE}
# # Fit the linear model with the mean as the response 
fit <- lm(mean ~ Group, data = RATSL8S)


# Fit the linear model with the mean as the response after filtering outlier
fit1 <- lm(mean ~ Group, data = RATSL8S1)

# Compute the analysis of variance table for the fitted model with anova()
anova(fit)
anova(fit1)

```

## Analysis of BPRS data

```{r, include=FALSE}
load("~/GitHub/IODS-project/data/BPRSL.Rdata")
setwd("~/GitHub/IODS-project/data")
library(readr)
RATS <- read_csv("BPRS.csv")

```


### **Overview of BPRSL (long form) data**

```{r, echo=FALSE}
head(BPRSL)
glimpse(BPRSL)
```


### **Plotting the BPRSL data**

```{r, echo=FALSE}

# Check the dimensions of the data
dim(BPRSL)

# Plot the BPRSL data
ggplot(BPRSL, aes(x = week, y = bprs)) +
  geom_line(aes(linetype = treatment)) +
  scale_x_continuous(name = "week") +
  scale_y_continuous(name = "bprs") +
  theme(legend.position = "top")


ggplot(BPRSL, aes(x = week, y = bprs, linetype = subject)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ treatment, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(BPRSL$bprs), max(BPRSL$bprs)))

```




### **Creating a regression model**

```{r, echo=FALSE}


# create a regression model RATS_reg
BPRS_reg <- lm(bprs ~ week + treatment, data = BPRSL)

# print out a summary of the model
summary(BPRS_reg)

```


### **Random intercept model for the same two explanatory variables**

```{r, echo=FALSE}


# access library lme4
library(lme4)

# Create a random intercept model
BPRS_ref <- lmer(bprs ~ week + treatment + (1 | subject), data = BPRSL, REML = FALSE)

# Print the summary of the model
summary(BPRS_ref)
anova(BPRS_ref)

```

### **Random intercept and random slope model**

```{r, echo=FALSE}


# create a random intercept and random slope model
BPRS_ref1 <- lmer(bprs ~ week + treatment + (week | subject), data = BPRSL, REML = FALSE)

# print a summary of the model
summary(BPRS_ref1)

# perform an ANOVA test 
anova(BPRS_ref1)

```


```{r, echo=FALSE}
# perform an ANOVA test on the two models
anova(BPRS_ref, BPRS_ref1)
```

### **Random Intercept and Random Slope Model with interaction**

```{r, echo=FALSE}
# dplyr, tidyr, lme4, ggplot2, RATS and RATSL are available

# create a random intercept and random slope model
BPRS_ref2 <- lmer(bprs ~ week * treatment + (week | subject), data = BPRSL, REML = FALSE)

# print a summary of the model
summary(BPRS_ref2)

# perform an ANOVA test on the two models
anova(BPRS_ref2, BPRS_ref1)

# draw the plot
ggplot(BPRSL, aes(x = week, y = bprs, group = treatment)) +
  geom_line(aes(linetype = treatment)) +
  scale_x_continuous(name = "weeks") +
  scale_y_continuous(name = "bprs") +
  theme(legend.position = "top")

# Create a vector of the fitted values
Fitted <- fitted(BPRS_ref2)

# Create a new column fitted to BPRSL
BPRSL <- BPRSL %>%
  mutate(Fitted)

# draw the plot of BPRSL
ggplot(BPRSL, aes(x = week, y = Fitted)) +
  geom_line(aes(linetype = treatment)) +
  scale_x_continuous(name = "weeks") +
  scale_y_continuous(name = "Fitted bprs") +
  theme(legend.position = "top")

```

